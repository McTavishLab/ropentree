---
title: "nameset_tool"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{nameset_tool}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(ropentree)
```

# creating a CSV file for importing pre-mapped names

## read the tree in
phy <- ape::read.tree(file="data-raw/mgharvey-tyranni-f73aa7f/species_trees/final_timetrees/T400F_complete.tre")

ls(phy)
str(phy)
phy$edge

## create a vector of tree tip labels
original_labels <- phy$tip.label

head(original_labels)

## get labels suitable for OTU mapping

### read the csv file linking tree tip labels with scientific taxon names

table <- read.csv(file = "data-raw/mgharvey-tyranni-f73aa7f/Species_name_map_uids.csv")

head(table)
ls(table)
class(table)

# create a vector of scientific species names useful for TNRS matching

adjusted_labels <- unique(table$matrix.species)
head(adjusted_labels)
write(adjusted_labels, file = "../data-raw/harvey2020scientific_names.txt")

adjusted_labels  <-  read.csv(file = "../data-raw/harvey2020scientific_names.txt", header = FALSE)[,1]

# Performs a TNRS match

matched_labels  <-  sapply(adjusted_labels, rotl::tnrs_match_names)

head(matched_labels)

# Get the ott ids

First, match the vector of species names with tnrs results

index <- match(table$matrix.species, names(matched_labels["ott_id",]))

Get a vector of OTT ids in the correct order

ott <- unlist(matched_labels["ott_id",][index])

# Create a data frame and write it as csv

results <- data.frame(original = original_labels, adjusted = table$matrix.species, ott_id = ott)

write.csv(results, file = "../data-raw/harvey2020nameset.csv)



# Creating a json file 


